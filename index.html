<!--以下を参考に-->
<!--https://teratail.com/questions/151938 -->
<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>Web Speech API</title>
	
	
	<script>
		var recognizing;
		
		init();
		function init() {
			// 変数とhtml内の連携
			const recognitionState = document.querySelector("#recognitionState");
			const confidence = document.querySelector("#recognitionState");
			const resultText = document.querySelector("#resultText");
			
			// 音声認識の準備
			window.SpeechRecognition = window.SpeechRecognition || webkitSpeechRecognition;
			recognition = new webkitSpeechRecognition();
			recognition.continuous = true;
			recognition.lang = 'ja';
			recognition.interimResults = true;
			
			// 関数の用意
			recognition.onend = reset;
			recognition.onresult = disp;
			
		}
		// 音声認識出力関数
		function disp(event) {
			var results = event.results;
			for (var i = event.resultIndex; i < results.length; ++i) {
				if (results[i].isFinal) {
					recognitionState.innerHTML = "認識終了";
					confidence.innerHTML = results[i][0].confidence;
					resultText.innerHTML = results[i][0].transcript;
					//document.getElementById('textarea').value += results[i][0].transcript + "\n";
				}
				else{
					recognitionState.innerHTML = "認識中";
					confidence.innerHTML = results[i][0].confidence;
					resultText.innerHTML = '<i style="color:#ddd;">' + results[i][0].transcript + '</i>';
				}
			}
		}
		// スタート関数
		function start() {
			init();
			recognition.start();
		}
		// ストップ関数
		function stop() {
			recognition.onend = null;
			recognition.stop();
		}
		// 停止したときの再スタート関数
		function reset() { 
			console.log("reset\n");
			init();
			recognition.start();
		} 
		recognition.onerror = function(event)  {
			console.log('音声認識エラーが検出されました：' + event.error);
		}
	</script>
	
</head>

<body>
	<div id="recognitionState">認識表示</div>
	<div id="confidence">信頼度表示</div>
	<div id="resultText">結果表示</div>
	<button id="start" onclick="start()">Start</button>
	<button id="stop" onclick="stop()">Stop</button>
</body>